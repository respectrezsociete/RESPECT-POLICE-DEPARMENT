<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>نظام إدارة الشرطة - MDT</title>
<style>
:root{
  --bg:#0b1220; --card:#0f1724; --accent:#1e90ff; --accent-2:#00d1c1; --muted:#9fbec5;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Inter, system-ui, -apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; background:linear-gradient(180deg,var(--bg),#071024); color:#e6eef8;
  -webkit-font-smoothing:antialiased;
}
header{padding:18px 20px;background:linear-gradient(90deg,#061126,#081427);display:flex;align-items:center;justify-content:space-between}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(90deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#001;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
.title{font-weight:800;font-size:18px}
.header-note{color:var(--muted);font-size:13px}
.container{max-width:1180px;margin:28px auto 80px;padding:0 16px}
.login-center{display:flex;justify-content:center;align-items:center;height:64vh}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.input, select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;margin-top:8px}
.btn{background:var(--accent);color:#001;border:none;padding:9px 12px;border-radius:8px;font-weight:700;cursor:pointer;margin-top:8px}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#cfeff4}
.grid{display:grid;grid-template-columns:1fr;gap:16px}
.row{display:flex;gap:16px;flex-wrap:wrap}
.section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.small{font-size:13px;color:var(--muted)}
.table{width:100%;border-collapse:collapse;font-size:13px;margin-top:8px}
.table th,.table td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:right}
.map-container{height:420px;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.04);position:relative}
.map-content{width:1200px;height:1200px;background-image:url('https://i.imgur.com/dT2Wgh2.jpg');background-size:cover;position:absolute;top:0;left:0;cursor:grab;transform-origin:0 0}
.hidden{display:none}
.badge{padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#001;font-weight:800}
.controls{display:flex;gap:8px;flex-wrap:wrap}
.officers-table th, .officers-table td{border:1px solid rgba(255,255,255,0.03);padding:8px}
.header-right{display:flex;gap:12px;align-items:center;color:var(--muted)}
@media(max-width:900px){
  .map-container{height:320px}
}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">R</div>
    <div>
      <div class="title">إدارة شرطة RESPECT</div>
      <div class="small header-note">نظام إدارة الدوريات والبلاغات (MDT)</div>
    </div>
  </div>
  <div class="header-right">
    <div class="small">المستخدم الحالي: <span id="header-username">—</span></div>
    <button id="logout-btn" class="btn ghost hidden" onclick="doLogout()">تسجيل الخروج</button>
  </div>
</header>

<div class="container">
  <!-- LOGIN -->
  <div id="login-screen" class="login-center">
    <div style="width:420px">
      <div class="card">
        <div style="text-align:center;margin-bottom:10px">
          <div style="font-size:20px;font-weight:800">نظام إدارة شرطة RESPECT</div>
          <div class="small" style="margin-top:6px">تسجيل الدخول</div>
        </div>

        <input id="login-username" class="input" placeholder="اسم المستخدم" />
        <input id="login-password" class="input" placeholder="كلمة المرور" type="password" />
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn" onclick="doLogin()">تسجيل الدخول</button>
        </div>
        <div id="login-msg" class="small" style="margin-top:10px;color:#ffdcdc"></div>
      </div>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="app-screen" class="hidden">
    <div class="grid">
      <div class="card">
        <div class="section-title">
          <h3 id="welcome-title">مرحباً</h3>
          <div class="small">MDT • RESPECT</div>
        </div>

        <div class="row" style="align-items:center">
          <div style="flex:1;min-width:220px">
            <div class="small">اسم المستخدم</div>
            <div id="user-badge" class="badge">—</div>
          </div>

          <div style="width:200px">
            <div class="small">الرتبة</div>
            <div id="user-rank" class="small">—</div>
          </div>

          <div style="width:160px">
            <div class="small">نقاط الخبرة (XP)</div>
            <div id="user-xp" class="small">0</div>
          </div>

          <div style="flex-basis:260px;display:flex;justify-content:flex-end;gap:8px">
            <button class="btn ghost" onclick="openCreateUser()">إنشاء حساب شرطي</button>
            <button class="btn" onclick="openUnits()">الوحدات</button>
          </div>
        </div>
      </div>

      <!-- باقي المحتوى يبقى كما هو -->
      <!-- ... هنا تضع باقي الأكواد بدون تغيير ... -->

    </div>
  </div>
</div>

<script>
/* =========================
   البيانات الأساسية
   ========================= */
const LS_USERS_KEY = 'mdt_users_v1';
const LS_PEOPLE_KEY = 'mdt_people_v1';
const LS_INC_KEY = 'mdt_incidents_v1';

// ensure storage exists
if(!localStorage.getItem(LS_USERS_KEY)){
  const initUsers = [{ id:1, fullname:'Dev', nick:'Dev', username:'dev', password:'206600911', rank:'Commander', badge:'000', xp:0, status:'Active' }];
  localStorage.setItem(LS_USERS_KEY, JSON.stringify(initUsers));
}
let users = JSON.parse(localStorage.getItem(LS_USERS_KEY));
let people = JSON.parse(localStorage.getItem(LS_PEOPLE_KEY) || '[]');
let incidents = JSON.parse(localStorage.getItem(LS_INC_KEY) || '[]');

let currentUser = null;

/* =========================
   تسجيل الدخول
   ========================= */
function doLogin(){
  const u = document.getElementById('login-username').value.trim();
  const p = document.getElementById('login-password').value.trim();
  const user = users.find(x => x.username === u && x.password === p);
  const msg = document.getElementById('login-msg');
  if(!user){ msg.innerText = 'خطأ في اسم المستخدم أو كلمة المرور'; return; }
  if(user.status && user.status === 'Banned'){ msg.innerText = 'الحساب محظور'; return; }
  currentUser = user;
  // عرض التطبيق
  document.getElementById('login-screen').classList.add('hidden');
  document.getElementById('app-screen').classList.remove('hidden');
  document.getElementById('header-username').innerText = currentUser.username + ' • ' + currentUser.rank;
  document.getElementById('user-badge').innerText = currentUser.fullname || currentUser.username;
  document.getElementById('user-rank').innerText = currentUser.rank || '-';
  document.getElementById('user-xp').innerText = currentUser.xp || 0;
  document.getElementById('logout-btn').classList.remove('hidden');
  renderOfficersTable();
  renderPeopleList();
  renderIncidentsList();
  // السماح بإنشاء حسابات فقط للمطور
  if(currentUser.username === 'dev'){
    document.getElementById('create-police-card').style.display = 'block';
  } else {
    document.getElementById('create-police-card').style.display = 'none';
  }
}
function doLogout(){
  currentUser = null;
  document.getElementById('app-screen').classList.add('hidden');
  document.getElementById('login-screen').classList.remove('hidden');
  document.getElementById('header-username').innerText = '—';
  document.getElementById('logout-btn').classList.add('hidden');
}

// باقي الأكواد كما هي
renderAll();
</script>
</body>
</html>
